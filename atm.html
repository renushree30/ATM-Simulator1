<%@ page import="java.util.*" %>
<%
    // Initialize balance (would typically be in a database or session)
    Float balance = (Float) application.getAttribute("balance");
    if (balance == null) {
        balance = 1000.0f;
        application.setAttribute("balance", balance);
    }

    String message = "";
    String pinParam = request.getParameter("pin");
    String action = request.getParameter("action");
    String amountParam = request.getParameter("amount");

    int correctPin = 4321;

    if (pinParam != null) {
        int pin = Integer.parseInt(pinParam);

        if (pin == correctPin) {
            float amount = 0;
            if (amountParam != null && !amountParam.isEmpty()) {
                amount = Float.parseFloat(amountParam);
            }

            if ("deposit".equals(action)) {
                if (amount > 0) {
                    balance += amount;
                    message = "Deposit successful! New balance: " + balance;
                } else {
                    message = "Invalid deposit amount.";
                }
            } else if ("withdraw".equals(action)) {
                if (amount > 0 && (balance - amount) >= 500) {
                    balance -= amount;
                    message = "Withdrawal successful! New balance: " + balance;
                } else {
                    message = "Cannot withdraw this amount. Maintain minimum balance of 500.";
                }
            } else if ("balance".equals(action)) {
                message = "Your current balance is: " + balance;
            } else {
                message = "Invalid action selected.";
            }

            application.setAttribute("balance", balance);
        } else {
            message = "Incorrect PIN. Access denied.";
        }
    }
%>

<!DOCTYPE html>
<html>
<head>
    <title>ATM System</title>
    <style>
        body {
            font-family: Arial;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .atm-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px gray;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
        }
        .result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="atm-box">
        <h2>ATM Interface</h2>
        <form method="post">
            <label>Enter PIN:</label>
            <input type="password" name="pin" required>

            <label>Select Action:</label>
            <select name="action">
                <option value="deposit">Deposit</option>
                <option value="withdraw">Withdraw</option>
                <option value="balance">Check Balance</option>
            </select>

            <label>Amount (if applicable):</label>
            <input type="number" name="amount" min="1">

            <input type="submit" value="Submit">
        </form>

        <div class="result">
            <%= message %>
        </div>
    </div>
</body>
</html>